<!doctype html>
<meta charset="UTF-8" />
<meta name="color-scheme" content="dark light" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="icon" href="data:," />
<link rel="stylesheet" href="static/style.css" />

<title>Python WebAssembly</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.27.2/full/pyodide.js"></script>
<script>
    async function main() {
        // Load Pyodide
        let pyodide = await loadPyodide();
        pyodide.setDebug(true);

        await pyodide.loadPackage("texttable");

        // Define Python script to fetch data from API and display it
        let pythonCode = `

            import asyncio
            import js,json
            from pyodide.http import pyfetch
            from texttable import Texttable

            async def fetch_data(user_ifsc):
                url = f'https://ifsc.razorpay.com/{user_ifsc}'
                response = await pyfetch(url)
                json_data = await response.json()
                js.console.log(json_data)

                table = Texttable()
                table.add_row(["Data", "Description"])  # Add header
                for key, value in json_data.items():
                    table.add_row([key, value])  # Add rows
                # Display JSON data on the web page
                document = js.document
            #    pre = document.createElement('code')
            #    pre.textContent = json.dumps(json_data, indent=4)
            #    document.body.appendChild(pre)
                pre = document.getElementById('jsonResult')
                if pre is None:
                    pre = document.createElement('pre')
                    pre.id = 'jsonResult'
            #        center = document.getElementById('centerTag')
            #        center.appendChild(pre)
                    document.querySelector('center').appendChild(pre)
                pre.textContent = json.dumps(json_data, sort_keys=True,indent=4).replace('{','').replace('}','')
            #    pre.textContent = table.draw()


            # Run the fetch_data coroutine
            # after we Get user input ifsc from JavaScript and to call fetch_data
            def call_fetch_data(*args, **kwargs):
                user_ifsc = js.document.getElementById('userInput').value
                asyncio.ensure_future(fetch_data(user_ifsc))

            #from js import document
            #document.getElementById('fetchButton').addEventListener('click', call_fetch_data)

            from js import document
            from pyodide.ffi import create_proxy

            # Create a proxy for the Python function
            call_fetch_data_proxy = create_proxy(call_fetch_data)
            document.getElementById('fetchButton').addEventListener('click', call_fetch_data_proxy)

            `;

        // Run the Python script
        pyodide.runPythonAsync(pythonCode);
    }

    main();
</script>

<center id="centerTag">
    <h1>Get Full Bank Details from IFSC</h1>
    <input
        required
        type="text"
        id="userInput"
        minlength="11"
        maxlength="11"
        placeholder="IFSC Ex: SBIN0015615"
    />
    <button id="fetchButton" type="submit">Get Bank Details</button>
    <p>The Bank details will be displayed below:</p>
</center>
<footer>
    <a class="links" href="https://dineshkumar.xyz">Handcrafted</a> _/\_ with ‚ô•
    and ü™≤Ô∏è for the open web. Updated: 14Mar25<br />
    Powered by: Python
    <a class="links" href="https://pyodide.org">Pyodide</a>,
    <a class="links" href="https://webassembly.org">WebAssembly</a> and
    <a class="links" href="https://razorpay.com">Razorpay</a>. The
    <a class="links" href="https://codeberg.org/sdk/getBankDetailsFromIFSC"
        >code for this site</a
    >
    is
    <a
        class="links"
        href="https://codeberg.org/sdk/getBankDetailsFromIFSC/src/branch/main/LICENSE"
        >MIT Licensed</a
    >.<br />
</footer>
